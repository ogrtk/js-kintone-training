# JavaScript & Kintoneカスタマイズ研修 スピーチ原稿

## 研修開始（5分）

### オープニング

皆さん、お疲れ様です。本日は貴重なお時間をいただき、ありがとうございます。

今日は2時間という限られた時間で、JavaScriptの基礎からKintoneカスタマイズまでを一気に学んでいただきます。「2時間で本当にできるようになるの？」と思われるかもしれませんが、ご安心ください。

今日の目標は、**Kintoneカスタマイズの基礎概念を理解し、自習で発展できる土台を築くこと**です。完璧にマスターする必要はありません。まずは「動くもの」を作る体験をしていただき、その後は皆さんのペースで発展させていけばよいのです。

### 今日の流れ

- 最初の10分：JavaScriptとHTMLの関係を理解
- 次の30分：JavaScript基礎を実践的に学習
- 10分：イベントリスナーの基礎概念
- 22分：Kintoneの仕組みとイベント
- 25分：実際にカスタマイズを一緒に作成
- 最後10分：デバッグ方法とこれからの学習

重要なのは、**全て実際に手を動かしながら進める**ことです。理論の説明は最小限に抑え、「動かして覚える」スタイルで進めていきます。

---

## 1. JavaScript と HTML の関係（10分）

### 導入（2分）

それでは早速始めましょう。まず、皆さんにお配りしたdemo1.htmlファイルをブラウザで開いてください。

**（受講者の作業を待つ）**

開きましたか？では、全員でF12キーを押してください。画面の下か右側に開発者ツールが表示されましたね。この「Console」タブをクリックしてください。

これが今日最も重要なツールです。JavaScriptの動作を確認するために使います。

### 実演（3分）

画面に「田中」と入力されたテキストボックスと「送信」ボタンがありますね。まず、名前を自分の名前に変更してから、送信ボタンをクリックしてみてください。

**（受講者の作業を待つ）**

どうでしょう？アラートが表示されましたね。そして、Consoleにも文字が出力されています。これがJavaScriptの動作です。

### 説明（3分）

今見ていただいたように、HTMLは「見た目」を作り、JavaScriptは「動作」を制御します。そして、Consoleは「何が起きているか」を確認するためのツールです。

この関係性は、Kintoneでも全く同じです。

- HTMLの代わりに → Kintoneのフィールド
- JavaScriptは → カスタマイズ処理
- Consoleは → デバッグとテスト確認

### まとめ（2分）

つまり、今覚えていただいたF12 → Console確認という流れは、Kintoneカスタマイズでも毎回使います。これだけで、エラーの原因の8割は解決できるようになります。

では次に、JavaScriptの基礎を学んでいきましょう。

---

## 2. JavaScript基礎（20分）

### 変数の実習（4分）

次にdemo2.htmlを開いてください。今度も同じようにF12でConsoleを開いておいてください。

このページは自動的にJavaScriptが実行されて、Consoleに結果が表示されています。見てください。変数の宣言、値の取得、データ型の確認、すべてがConsoleに表示されていますね。

**変数とは何か：**
変数とは「データを入れる箱」だと考えてください。箱には名前をつけて、後でその名前を使ってデータを取り出せます。

重要なポイントは3つです：

- `let`は変更可能な変数 → 箱の中身を後で変更できる
- `const`は変更不可能な定数 → 一度入れたら変更できない
- `var`は古い書き方なので使わない

Consoleを見ると、`typeof`でデータの種類も確認できています：

- 文字列（string）：「田中」のように文字のデータ
- 数値（number）：100のような計算に使える数字
- 真偽値（boolean）：trueかfalseの2つだけ

これらの変数は、Kintoneではフィールドの値を格納するために使います。

### 関数の実習（5分）

続いてdemo3.htmlを開いてください。関数の動作を確認しましょう。

**関数とは何か：**
関数とは「処理をまとめたもの」です。料理のレシピのようなものですね。材料（引数）を渡すと、決まった手順で処理して、結果（戻り値）を返してくれます。

Consoleを見ると、関数が実行される様子が詳細に表示されています。「calculateTotal関数が呼ばれました」「計算結果：500」などが見えますね。

**引数（ひきすう）について：**

```javascript
function calculateTotal(price, quantity) {
    return price * quantity;
}
```

この関数では：

- `price`と`quantity`が**引数**です
- 引数とは「関数に渡すデータ」のことです
- 複数の引数をカンマで区切って受け取れます
- 引数は関数の中で変数として使えます

実際に関数を呼び出すときは：

```javascript
let result = calculateTotal(100, 5);
```

- `100`が`price`に入ります
- `5`が`quantity`に入ります

**戻り値（かえりち）について：**

- `return`で関数の結果を返します
- `return price * quantity;`は計算結果を呼び出し元に返す
- 戻り値は変数に代入したり、そのまま使ったりできます

**引数と戻り値の流れ：**

1. 関数を呼び出す → `calculateTotal(100, 5)`
2. 引数が関数内の変数に入る → `price=100, quantity=5`
3. 処理を実行 → `100 * 5 = 500`
4. 結果を返す → `return 500`
5. 呼び出し元で受け取る → `result = 500`

**引数がない関数もある：**

```javascript
function getCurrentTime() {
    return new Date();
}
```

**戻り値がない関数もある：**

```javascript
function showMessage(text) {
    alert(text);
    // returnがない場合、undefinedが返される
}
```

2種類の書き方がありますが、どちらでも同じ結果になります：

**従来の書き方：**

```javascript
function calculateTotal(price, quantity) {
    return price * quantity;
}
```

**アロー関数（短い書き方）：**

```javascript
const calculateTotal = (price, quantity) => {
    return price * quantity;
};
```

最初は基本的な`function`で書いて、慣れてきたらアロー関数を使えばよいでしょう。

Kintoneでは、「フィールドが変更されたときの処理」や「保存前のチェック処理」などで関数を使います。特に引数として`event`を受け取り、戻り値として`event`を返すパターンが基本になります。

### オブジェクトの実習（5分）

demo4.htmlを開いてください。これが最も重要な部分です。

**オブジェクトとは何か：**
オブジェクトとは「関連するデータをまとめて管理するもの」です。例えば「人」というオブジェクトなら、名前、年齢、メールアドレスなどの属性を一つにまとめられます。

Consoleの最初の部分を見てください：

```javascript
let user = {
    name: '田中',
    age: 30,
    email: 'tanaka@example.com'
};
```

これは一人の人の情報を1つのオブジェクトにまとめたものです。

**オブジェクトの重要な特徴：**

1. **複数の属性を持てる：** 名前、年齢、メールなど、いくつでも属性を追加できます

2. **入れ子にできる：** オブジェクトの中にオブジェクトを入れることも可能です

   ```javascript
   let user = {
       name: '田中',
       address: {
           postal: '100-0001',
           city: '東京都'
       }
   };
   ```

3. **2つの取得方法：**
   - ドット記法：`user.name`
   - ブラケット記法：`user['name']`

Consoleの後半に「Kintoneレコード形式の例」という部分がありますね。これがKintoneのレコードの実際の構造です。

```javascript
"商品名": { "value": "ノートパソコン" }
```

これは「商品名というフィールドの中に、valueという属性があり、その値がノートパソコン」という意味です。オブジェクトの入れ子構造になっています。

この形式を覚えてください。Kintoneでは、すべてのフィールドがこの`{ "value": "値" }`という形で管理されています。

つまり、フィールドの値を取得するときは`record["商品名"].value`と書くわけです。

### 配列の実習（5分）

demo5.htmlを開いてください。

**配列とは何か：**
配列とは「同じ種類のデータを順番に並べて管理するもの」です。買い物リストのようなものですね。

Consoleを見ると：

```javascript
let fruits = ['りんご', 'みかん', 'ばなな'];
```

これは果物のリストを配列で管理しています。

**配列の重要な特徴：**

1. **添字（インデックス）でアクセス：**
   - `fruits[0]` → 'りんご'（0番目）
   - `fruits[1]` → 'みかん'（1番目）
   - `fruits[2]` → 'ばなな'（2番目）

   **注意：配列は0から数え始めます！**

2. **長さがわかる：** `fruits.length`で要素の数がわかります

3. **動的に追加できる：** `fruits.push('ぶどう')`で新しい要素を追加

4. **for文でループ処理：**

   **for文とは何か：**
   for文は「繰り返し処理」を行うための仕組みです。「配列の全要素に対して同じ処理を実行したい」ときに使います。

   ```javascript
   for (let i = 0; i < fruits.length; i++) {
       console.log(fruits[i]);
   }
   ```

   **for文の構造を詳しく解説：**
   - `let i = 0` → カウンター変数iを0で初期化
   - `i < fruits.length` → 「iが配列の長さより小さい間」継続
   - `i++` → 毎回iを1増やす
   - `{ ... }` → 繰り返し実行される処理

   **実行の流れ：**
   1. i=0で開始 → fruits[0]を処理
   2. i=1に増加 → fruits[1]を処理  
   3. i=2に増加 → fruits[2]を処理
   4. i=3になると「3 < 3」が偽になるので終了

   Consoleで実際の実行過程を確認してください。「0番目: りんご」「1番目: みかん」と順番に表示されていますね。

5. **より実用的な例：**
   Consoleの下の方で、より実用的な例も確認できます。レコードの配列を処理する例ですね：

   ```javascript
   let records = [
       { "名前": "田中", "点数": 85 },
       { "名前": "佐藤", "点数": 92 }
   ];
   ```

   これは「オブジェクトの配列」です。複数の人の情報を配列で管理し、for文で全員の情報を処理しています。

**for文の重要性：**
Kintoneでは、レコード一覧を処理するときにfor文を頻繁に使用します。例えば「全レコードの合計を計算する」「条件に合うレコードを抽出する」などの処理で必須の技術です。

### 条件分岐の実習（3分）

demo6.htmlを確認してください。

**条件分岐とは：**
「もし〜なら〜する、そうでなければ〜する」という処理です。日常生活での判断と同じですね。

基本的な形：

```javascript
if (条件) {
    // 条件が真の場合の処理
} else if (別の条件) {
    // 別の条件が真の場合の処理
} else {
    // どの条件も満たさない場合の処理
}
```

Consoleを見ると、点数によって評価が変わる例が確認できます。これがバリデーション（入力チェック）の基本的な考え方です。

実際のKintoneでは：

- 「数量が0以下なら警告する」
- 「メールアドレスが空なら保存を停止する」
- 「ステータスが完了なら特定のフィールドを表示する」

このような処理で条件分岐を使います。

### 基礎のまとめ（なし）

今見ていただいた5つの概念：

- **変数**：データを入れる箱
- **関数**：処理をまとめたレシピ
- **オブジェクト**：関連データをまとめた構造体（入れ子可能）
- **配列**：データを順番に並べたリスト（添字でアクセス）
- **条件分岐**：状況に応じた処理の分岐

これでKintoneカスタマイズに必要なJavaScript基礎は網羅されています。

重要なのは、すべてConsoleで動作が確認できることです。実際のKintoneでカスタマイズを作るときも、同じようにConsoleで動作を確認しながら進めます。

では、いよいよKintoneの世界に入っていきましょう。

---

## 2.5. イベントリスナーの基礎（10分）

### Kintoneの前に理解すべき重要な概念（2分）

JavaScriptの基礎を学んだところで、Kintoneカスタマイズに入る前に、もう一つ重要な概念を理解しましょう。

それが「**イベントリスナー**」です。これはKintoneの`kintone.events.on()`を理解するために必須の知識です。

demo1.htmlをもう一度確認してください。

### イベントの概念（3分）

先ほどボタンをクリックしたときに起きたことを思い出してください：

- 「ボタンをクリックした」→これが**イベント**
- 「アラートが表示された」→これが**イベントへの反応**

**イベント**とは「ウェブページで起こる出来事」のことです：

- ボタンのクリック
- テキストボックスへの入力
- ページの読み込み完了
- マウスの移動 など

### イベントリスナーの仕組み（5分）

demo1.htmlの中には、実際にこのようなコードが書かれています：

```javascript
document.getElementById('btn').onclick = function() {
    let nameValue = document.getElementById('name').value;
    console.log('入力された名前:', nameValue);
    alert('送信されました：' + nameValue);
};
```

**イベントリスナーとは：**
「特定のイベントが起きたときに実行される関数」のことです。

**構造を分解すると：**

1. **イベントの対象**：`document.getElementById('btn')`
   - 「どの要素のイベントを監視するか」

2. **イベントの種類**：`.onclick`
   - 「どんなイベントを監視するか」

3. **実行する関数**：`function() { ... }`
   - **重要：関数そのものを代入している**

**より現代的な書き方：**

```javascript
document.getElementById('btn').addEventListener('click', function() {
    // 処理
});
```

この`addEventListener`では：

- 第1引数：`'click'`（イベントの種類）
- 第2引数：`function() { ... }`（実行する関数）

**ここが重要なポイント：引数として関数を渡している！**

これが「コールバック関数」という仕組みです。

- 関数を呼び出すのは、私たちではない
- ブラウザが「イベントが起きたとき」に自動的に関数を呼び出す
- 私たちは「このイベントが起きたら、この関数を実行してください」とお願いしているだけ

### KintoneとHTML、同じ仕組み（なし）

この仕組みは、Kintoneでも全く同じです：

**HTML/JavaScript：**

```javascript
element.addEventListener('click', function() {
    // クリック時の処理
});
```

**Kintone：**

```javascript
kintone.events.on('app.record.edit.change.数量', function(event) {
    // フィールド変更時の処理
});
```

- HTMLでは`addEventListener`
- Kintoneでは`kintone.events.on`
- どちらも「イベントが起きたら関数を実行」という同じ仕組み
- どちらも第2引数に関数を渡している

つまり、今理解していただいたイベントリスナーの概念が、そのままKintoneカスタマイズに応用されるのです。

---

## 3. Kintoneの仕組みとイベント（22分）

### イベント駆動の概念（8分）

Kintoneカスタマイズの最大の特徴は「イベント駆動」であることです。

通常のプログラムは「上から順番に実行」されますが、Kintoneでは「何かが起きたときに実行」されます。

例えば：

- レコードを表示したとき
- フィールドの値を変更したとき  
- 保存ボタンを押したとき

これらの「とき」を「イベント」と呼びます。

主要なイベントは覚えやすい名前になっています：

- `app.record.detail.show` → 詳細画面を**表示**したとき
- `app.record.edit.change.数量` → **数量**フィールドを**変更**したとき
- `app.record.create.submit` → 新規レコードを**保存**するとき

### 基本パターンの説明（7分）

すべてのKintoneカスタマイズは、この基本パターンで書きます：

```javascript
kintone.events.on('イベント名', function(event) {
    // ここに処理を書く
    return event;  // 最後に必ずreturn
});
```

先ほど学んだイベントリスナーと全く同じ仕組みですね！

**HTMLとKintoneの比較：**

```javascript
// HTML
element.addEventListener('click', function() {
    // 処理
});

// Kintone
kintone.events.on('app.record.edit.change.数量', function(event) {
    // 処理
    return event;
});
```

**重要なポイント：**

1. **同じコールバック関数の仕組み：**
   - 第1引数：イベント名（文字列）
   - 第2引数：実行する関数
   - 関数を呼び出すのはKintone（私たちではない）

2. **eventオブジェクト：**
   - HTMLでは必要に応じて`event`を受け取る
   - Kintoneでは必ず`event`オブジェクトが渡される
   - この`event`の中にレコードの情報がすべて入っている

3. **return eventが必須：**
   - HTMLでは通常returnは不要
   - Kintoneでは必ず`event`を返す必要がある
   - これによってKintoneが「処理が完了した」ことを知る

この`event`の中に、レコードの情報がすべて入っています。`event.record`でレコードにアクセスできます。

### レコード操作の実演（10分）

では、実際にレコードの値を取得・設定する方法を見てみましょう。

フィールドの値を取得するとき：

```javascript
let productName = record['商品名'].value;
let price = record['単価'].value;
```

フィールドの値を設定するとき：

```javascript
record['合計'].value = total;
```

さきほどdemo4.htmlで確認した形式と全く同じですね。

数値として使いたい場合は`parseInt()`で変換します：

```javascript
let price = parseInt(record['単価'].value) || 0;
```

この`|| 0`は「もし変換に失敗したら0にする」という意味です。これでエラーを防げます。

---

## 4. 実践：カスタマイズを一緒に作成（25分）

### 作成するもの（3分）

これから皆さんと一緒に、実用的なカスタマイズを作成します。

「入力チェック付き計算フィールド」を作ります：

1. 単価 × 数量 = 合計金額を自動計算
2. 数量が負の数の場合はエラーメッセージ
3. 合計が10万円を超える場合は警告
4. 保存前に必須チェック

実際の業務でよくあるパターンです。

### Step 1: 基本的な自動計算（7分）

まずは最もシンプルな自動計算から始めましょう。

テキストを見ながら、一緒にコードを書いていきます。

```javascript
(function() {
    'use strict';
    
    kintone.events.on('app.record.edit.change.数量', function(event) {
        let record = event.record;
        
        let price = parseInt(record['単価'].value) || 0;
        let quantity = parseInt(record['数量'].value) || 0;
        
        let total = price * quantity;
        record['合計'].value = total;
        
        return event;
    });
})();
```

ポイントを説明していきます：

**（各行を説明しながら進める）**

- `(function() { ... })()`は「即座に実行される関数」です。コードを安全に隔離します
- `'use strict'`はJavaScriptを厳密モードで実行します。エラーを防げます
- `parseInt() || 0`で安全に数値変換しています
- 最後の`return event`を忘れないでください

### Step 2: バリデーション追加（8分）

次に、入力チェック機能を追加しましょう。

```javascript
if (quantity < 0) {
    alert('数量に負の数は入力できません');
    record['数量'].value = 0;
    quantity = 0;
}
```

この部分を追加します。マイナス値が入力されたら、アラートを表示して0に戻します。

さらに警告機能も追加：

```javascript
if (total > 100000) {
    alert('合計金額が10万円を超えています。確認してください。');
}
```

実際の業務では、このような段階的なチェックが重要です。

### Step 3: 保存前チェック（9分）

最後に、保存前の最終チェックを追加します。

```javascript
kintone.events.on(['app.record.create.submit', 'app.record.edit.submit'], function(event) {
    let record = event.record;
    
    let quantity = parseInt(record['数量'].value) || 0;
    
    if (quantity <= 0) {
        event.error = '数量は1以上で入力してください';
        return event;
    }
    
    return event;
});
```

ここで重要なのは`event.error`です。これを設定すると、保存がキャンセルされ、エラーメッセージが表示されます。

`alert()`との違いは、`alert()`は警告だけで保存は続行されますが、`event.error`は保存を停止することです。

### 完成版の確認とデプロイ方法（なし）

これで完成です！実際にKintoneに設定する手順は以下の通りです：

1. このコードを`.js`ファイルとして保存
2. Kintoneアプリの「設定」→「JavaScript / CSS でカスタマイズ」
3. JavaScriptファイルをアップロード  
4. 「アプリを更新」をクリック

ただし、今日は時間の関係で実際のデプロイは行いません。持ち帰って試してみてください。

---

## 5. デバッグ・トラブル対応（10分）

### よくあるエラー（5分）

実際にカスタマイズを作ると、必ずエラーに遭遇します。でも大丈夫です。よくあるパターンは決まっています。

debug_practice.htmlを開いてください。ここによくあるエラーを再現してあります。

「エラーを実行」ボタンを押してから、「修正版を実行」ボタンを押して、違いを確認してください。

**（受講者と一緒に数個のエラーを体験）**

最も多いのは：

1. フィールドコードの入力ミス
2. `return event`の忘れ
3. 括弧の閉じ忘れ

### デバッグの手順（5分）

エラーが起きたときの対処手順は以下の通りです：

1. **まずF12でConsoleを確認**
   - 赤い文字でエラーメッセージが表示されます
   - 行番号も表示されるので、どこでエラーが起きたかわかります

2. **console.log()で変数の中身を確認**

   ```javascript
   console.log('変数の値:', variable);
   ```

3. **一行ずつコメントアウトして問題箇所を特定**

   ```javascript
   // この行が問題かも？
   ```

4. **Google検索**
   - エラーメッセージをそのまま検索すると、解決策が見つかります

この手順で、ほとんどのエラーは解決できます。

---

## 6. 次のステップ・自習の進め方（15分）

### 今日の達成事項（3分）

皆さん、2時間お疲れ様でした！

今日できるようになったことを確認しましょう：

- ✅ JavaScriptの基本文法を理解
- ✅ Kintoneイベントの仕組みを体験
- ✅ フィールド値の取得・設定方法をマスター
- ✅ 基本的なバリデーション処理を作成
- ✅ デバッグ方法を習得

これだけできれば、明日からKintoneの簡単なカスタマイズが可能です。

### 自習の進め方（5分)

今日お渡しした教材を使って、以下のスケジュールで学習を進めてください：

**今週中（復習期間）：**

- 今日のHTMLファイルをすべて再実行
- kintone_practice.htmlで実際のKintone操作を体験
- わからない部分は何度でも繰り返し

**来週（実践期間）：**

- 実際のKintoneアプリで簡単なカスタマイズを1つ作成
- kintone_sample.jsを参考にコードを書く
- エラーが出たらdebug_practice.htmlで類似例を確認

**今月中（発展期間）：**

- 公式ドキュメントを読んで新しい機能を1つ追加
- 他のイベントや高度な機能にチャレンジ

### 学習リソース（2分)

継続学習のための資料をご紹介します：

**公式ドキュメント：**

- Kintone開発者サイト
- JavaScript APIリファレンス

**今日の教材：**

- README.mdに詳しい使い方を記載
- 困ったときはHTMLファイルで基本に戻る

**社内サポート：**

- 実際にカスタマイズを作るときは、社内の詳しい方に相談
- エラーで困ったときも遠慮なく質問

### 最後のメッセージ（2分)

最後に、重要なことをお伝えします。

プログラミングは「完璧を目指さない」ことが成功の秘訣です。まずは「動くもの」を作って、徐々に改良していけばよいのです。

今日学んだことの1割でも実践していただければ、必ず役に立ちます。そして、一度動くものを作れば、どんどん自信がついてきます。

エラーを恐れる必要はありません。エラーは「学習のチャンス」です。今日覚えたF12 → Console確認の手順で、必ず解決できます。

### 質疑応答（なし）

ご質問がある方は、いつでもお声がけください。今後も皆さんのKintoneカスタマイズを応援いたします。

本日は、お疲れ様でした！

---

## 講師用メモ

### タイムキーピング

- 各セクションの開始時刻をメモ
- 遅れている場合は実習時間を調整
- 質疑応答は各セクション後に2-3分

### 受講者サポート

- 全員が同じペースで進めているか確認
- つまずいている人がいたら個別サポート
- F12が開けない人は重点的にフォロー

### 重要ポイント

1. F12 → Console確認は何度でも強調
2. 完璧を求めずに「動くもの」を作る
3. エラーを恐れずにチャレンジする姿勢

### 準備物チェック

- [ ] 各HTMLファイルの動作確認済み
- [ ] プロジェクターでデモ画面が見える
- [ ] 受講者全員がファイルを取得済み
- [ ] 予備のファイル（USBメモリ等）
